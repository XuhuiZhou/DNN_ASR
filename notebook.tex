
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{DNN\_ASR}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{DNN speech recognizer}\label{dnn-speech-recognizer}

The capstone project of NLP Engineer offered by Udacity

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

In this project, I built an Automatic Speech Recognition (ASR) pipeline
with the open-source dataset Libri Speech. Speech Recognition is
historically a challenging task in Artificial Intelligence due to the
noise and ambiguity in the speech. I invoked Mel Frequency Cepstral
Coefficients (MFCC) to extract features from raw audio signals in order
to reduce the dimensionality and noise caused by environmental factors.
I implemented different Deep Neural Networks (DNN) models to compare the
performance, and trained them with the Connectionist Temporal
Classification (CTC) loss function to address the variable length of the
same word in speech.

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Introduction}\label{introduction}

I build a deep neural network that functions as part of an end-to-end
automatic speech recognition (ASR) pipeline! My completed pipeline will
accept raw audio as input and return a predicted transcription of the
spoken language. The full pipeline is summarized in the figure below.

\begin{itemize}
\tightlist
\item
  \textbf{STEP 1} is a pre-processing step that converts raw audio to
  one of two feature representations that are commonly used for ASR.
\item
  \textbf{STEP 2} is an acoustic model which accepts audio features as
  input and returns a probability distribution over all potential
  transcriptions. After learning about the basic types of neural
  networks that are often used for acoustic modeling, I design my own
  acoustic model!
\item
  \textbf{STEP 3} in the pipeline takes the output from the acoustic
  model and returns a predicted transcription.
\end{itemize}

Feel free to use the links below to navigate the notebook: -
Section \ref{thedata} - Section \ref{step1}: Acoustic Features for
Speech Recognition - Section \ref{step2}: Deep Neural Networks for
Acoustic Modeling - Section \ref{model0}: RNN - Section \ref{model1}:
RNN + TimeDistributed Dense - Section \ref{model2}: CNN + RNN +
TimeDistributed Dense - Section \ref{model3}: Deeper RNN +
TimeDistributed Dense - Section \ref{model4}: Bidirectional RNN +
TimeDistributed Dense - Section \ref{compare} - Section \ref{final} -
Section \ref{step3}: Obtain Predictions

 \#\# The Data

I begin by investigating the dataset that will be used to train and
evaluate your pipeline.
\href{http://www.danielpovey.com/files/2015_icassp_librispeech.pdf}{LibriSpeech}
is a large corpus of English-read speech, designed for training and
evaluating models for ASR. The dataset contains 1000 hours of speech
derived from audiobooks.

I use the \texttt{vis\_train\_features} module to visualize a training
example. The supplied argument \texttt{index=0} tells the module to
extract the first example in the training set. The returned variables
are: - \texttt{vis\_text} - transcribed text (label) for the training
example. - \texttt{vis\_raw\_audio} - raw audio waveform for the
training example. - \texttt{vis\_mfcc\_feature} - mel-frequency cepstral
coefficients (MFCCs) for the training example. -
\texttt{vis\_spectrogram\_feature} - spectrogram for the training
example. - \texttt{vis\_audio\_path} - the file path to the training
example.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{from} \PY{n+nn}{data\PYZus{}generator} \PY{k}{import} \PY{n}{vis\PYZus{}train\PYZus{}features}
        
        \PY{c+c1}{\PYZsh{} extract label and audio features for a single training example}
        \PY{n}{vis\PYZus{}text}\PY{p}{,} \PY{n}{vis\PYZus{}raw\PYZus{}audio}\PY{p}{,} \PY{n}{vis\PYZus{}mfcc\PYZus{}feature}\PY{p}{,} \PY{n}{vis\PYZus{}spectrogram\PYZus{}feature}\PY{p}{,} \PY{n}{vis\PYZus{}audio\PYZus{}path} \PY{o}{=} \PY{n}{vis\PYZus{}train\PYZus{}features}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
There are 2136 total training examples.

    \end{Verbatim}

    The following code cell visualizes the audio waveform for my chosen
example, along with the corresponding transcript.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{Markdown}\PY{p}{,} \PY{n}{display}
        \PY{k+kn}{from} \PY{n+nn}{data\PYZus{}generator} \PY{k}{import} \PY{n}{vis\PYZus{}train\PYZus{}features}\PY{p}{,} \PY{n}{plot\PYZus{}raw\PYZus{}audio}
        \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{Audio}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        
        \PY{c+c1}{\PYZsh{} plot audio signal}
        \PY{n}{plot\PYZus{}raw\PYZus{}audio}\PY{p}{(}\PY{n}{vis\PYZus{}raw\PYZus{}audio}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} print length of audio signal}
        \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{**Shape of Audio Signal** : }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{vis\PYZus{}raw\PYZus{}audio}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} print transcript corresponding to audio clip}
        \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{**Transcript** : }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{vis\PYZus{}text}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} play the audio file}
        \PY{n}{Audio}\PY{p}{(}\PY{n}{vis\PYZus{}audio\PYZus{}path}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_3_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \textbf{Shape of Audio Signal} : (167691,)

    
    \textbf{Transcript} : the houses seemed miserable in the extreme
especially to an eye accustomed to the smiling neatness of english
cottages

    
\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}2}]:} <IPython.lib.display.Audio object>
\end{Verbatim}
            
     \#\# STEP 1: Acoustic Features for Speech Recognition

For this project, I first performs a pre-processing step to convert the
raw audio to a feature representation that has historically proven
successful for ASR models. My acoustic model will accept the feature
representation as input.

I will explore two possible feature
representations.\href{https://pdfs.semanticscholar.org/a566/cd4a8623d661a4931814d9dffc72ecbf63c4.pdf}{research
paper}.

\subsubsection{Spectrograms}\label{spectrograms}

The first option for an audio feature representation is the
\href{https://www.youtube.com/watch?v=_FatxGN3vAM}{spectrogram}. the
code for calculating the spectrogram was borrowed from
\href{https://github.com/baidu-research/ba-dls-deepspeech}{this
repository}. The implementation appears in the \texttt{utils.py} file in
the repository.

The code returns the spectrogram as a 2D tensor, where the first
(\emph{vertical}) dimension indexes time, and the second
(\emph{horizontal}) dimension indexes frequency. To speed the
convergence of the algorithm, I have also normalized the spectrogram.
(See this quickly in the visualization below by noting that the mean
value hovers around zero, and most entries in the tensor assume values
close to zero.)

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k+kn}{from} \PY{n+nn}{data\PYZus{}generator} \PY{k}{import} \PY{n}{plot\PYZus{}spectrogram\PYZus{}feature}
        
        \PY{c+c1}{\PYZsh{} plot normalized spectrogram}
        \PY{n}{plot\PYZus{}spectrogram\PYZus{}feature}\PY{p}{(}\PY{n}{vis\PYZus{}spectrogram\PYZus{}feature}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} print shape of spectrogram}
        \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{**Shape of Spectrogram** : }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{vis\PYZus{}spectrogram\PYZus{}feature}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_5_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \textbf{Shape of Spectrogram} : (759, 161)

    
    \subsubsection{Mel-Frequency Cepstral Coefficients
(MFCCs)}\label{mel-frequency-cepstral-coefficients-mfccs}

The second option for an audio feature representation is
\href{https://en.wikipedia.org/wiki/Mel-frequency_cepstrum}{MFCCs}. The
details of how MFCCs are calculated
\href{https://github.com/jameslyons/python_speech_features}{documentation}
of the \texttt{python\_speech\_features} Python package. Just as with
the spectrogram features, the MFCCs are normalized in the supplied code.

The main idea behind MFCC features is the same as spectrogram features:
at each time window, the MFCC feature yields a feature vector that
characterizes the sound within the window. Note that the MFCC feature is
much lower-dimensional than the spectrogram feature, which could help an
acoustic model to avoid overfitting to the training dataset.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k+kn}{from} \PY{n+nn}{data\PYZus{}generator} \PY{k}{import} \PY{n}{plot\PYZus{}mfcc\PYZus{}feature}
        
        \PY{c+c1}{\PYZsh{} plot normalized MFCC}
        \PY{n}{plot\PYZus{}mfcc\PYZus{}feature}\PY{p}{(}\PY{n}{vis\PYZus{}mfcc\PYZus{}feature}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} print shape of MFCC}
        \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{**Shape of MFCC** : }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{vis\PYZus{}mfcc\PYZus{}feature}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \textbf{Shape of MFCC} : (759, 13)

    
     \#\# STEP 2: Deep Neural Networks for Acoustic Modeling

In this section, I experiment with various neural network architectures
for acoustic modeling.

All models are specified in the \texttt{sample\_models.py} file.

After experimenting with the four simple architectures, I compare their
performance. Based on my findings, I construct a deeper architecture
that is designed to outperform all of the shallow models.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{c+c1}{\PYZsh{} allocate 50\PYZpc{} of GPU memory }
        \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{backend}\PY{n+nn}{.}\PY{n+nn}{tensorflow\PYZus{}backend} \PY{k}{import} \PY{n}{set\PYZus{}session}
        \PY{k+kn}{import} \PY{n+nn}{tensorflow} \PY{k}{as} \PY{n+nn}{tf} 
        \PY{n}{config} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{ConfigProto}\PY{p}{(}\PY{p}{)}
        \PY{n}{config}\PY{o}{.}\PY{n}{gpu\PYZus{}options}\PY{o}{.}\PY{n}{per\PYZus{}process\PYZus{}gpu\PYZus{}memory\PYZus{}fraction} \PY{o}{=} \PY{l+m+mf}{0.5}
        \PY{n}{set\PYZus{}session}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{n}{config}\PY{o}{=}\PY{n}{config}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} watch for any changes in the sample\PYZus{}models module, and reload it automatically}
        \PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} autoreload
        \PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
        \PY{c+c1}{\PYZsh{} import NN architectures for speech recognition}
        \PY{k+kn}{from} \PY{n+nn}{sample\PYZus{}models} \PY{k}{import} \PY{o}{*}
        \PY{c+c1}{\PYZsh{} import function for training acoustic model}
        \PY{k+kn}{from} \PY{n+nn}{train\PYZus{}utils} \PY{k}{import} \PY{n}{train\PYZus{}model}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
C:\textbackslash{}ProgramData\textbackslash{}Anaconda3\textbackslash{}lib\textbackslash{}site-packages\textbackslash{}h5py\textbackslash{}\_\_init\_\_.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from .\_conv import register\_converters as \_register\_converters
Using TensorFlow backend.

    \end{Verbatim}

     \#\#\# Model 0: RNN

Given their effectiveness in modeling sequential data, the first
acoustic model I use is an RNN. As shown in the figure below, the RNN
takes the time sequence of audio features as input.

At each time step, the speaker pronounces one of 28 possible characters,
including each of the 26 letters in the English alphabet, along with a
space character (" "), and an apostrophe (').

The output of the RNN at each time step is a vector of probabilities
with 29 entries, where the \(i\)-th entry encodes the probability that
the \(i\)-th character is spoken in the time sequence. (The extra 29th
character is an empty "character" used to pad training examples within
batches containing uneven lengths.) The \texttt{char\_map.py} file in
the repository descreibes how characters are mapped to indices in the
probability vector. The figure below shows an equivalent, rolled
depiction of the RNN that shows the output layer in greater detail.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{model\PYZus{}0} \PY{o}{=} \PY{n}{simple\PYZus{}rnn\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{)} 
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
rnn (GRU)                    (None, None, 29)          16617     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 16,617
Trainable params: 16,617
Non-trainable params: 0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    As explored in the lesson, I train the acoustic model with the
\href{http://www.cs.toronto.edu/~graves/icml_2006.pdf}{CTC loss}
criterion. Custom loss functions take a bit of hacking in Keras. For the
implementation details, look at the \texttt{add\_ctc\_loss} function
within the \texttt{train\_utils.py} file in the repository.

To train the architecture, I use the \texttt{train\_model} function
within the \texttt{train\_utils} module; it has already been imported in
one of the above code cells. The \texttt{train\_model} function takes
three \textbf{required} arguments: - \texttt{input\_to\_softmax} - a
Keras model instance. - \texttt{pickle\_path} - the name of the pickle
file where the loss history will be saved. - \texttt{save\_model\_path}
- the name of the HDF5 file where the model will be saved.

There are several \textbf{optional} arguments about the training
process. - \texttt{minibatch\_size} - the size of the minibatches that
are generated while training the model (default: \texttt{20}). -
\texttt{spectrogram} - Boolean value dictating whether spectrogram
(\texttt{True}) or MFCC (\texttt{False}) features are used for training
(default: \texttt{True}). - \texttt{mfcc\_dim} - the size of the feature
dimension to use when generating MFCC features (default: \texttt{13}). -
\texttt{optimizer} - the Keras optimizer used to train the model
(default:
\texttt{SGD(lr=0.02,\ decay=1e-6,\ momentum=0.9,\ nesterov=True,\ clipnorm=5)}).\\
- \texttt{epochs} - the number of epochs to use to train the model
(default: \texttt{20}). If you choose to modify this parameter, make
sure that it is \emph{at least} 20. - \texttt{verbose} - controls the
verbosity of the training output in the \texttt{model.fit\_generator}
method (default: \texttt{1}). - \texttt{sort\_by\_duration} - Boolean
value dictating whether the training and validation sets are sorted by
(increasing) duration before the start of the first epoch (default:
\texttt{False}).

The \texttt{train\_model} function defaults to using spectrogram
features; For these features, note that the acoustic model in
\texttt{simple\_rnn\_model} should have \texttt{input\_dim=161}.
Otherwise, for MFCC features, the acoustic model should have
\texttt{input\_dim=13}.

I choose to use \texttt{GRU} units in the supplied RNN and experiment
with \texttt{LSTM} or \texttt{SimpleRNN} cells. When I change the
\texttt{GRU} units to \texttt{SimpleRNN} cells in
\texttt{simple\_rnn\_model}, I notice that the loss quickly becomes
undefined (\texttt{nan}) - This is due to the
\href{http://www.wildml.com/2015/10/recurrent-neural-networks-tutorial-part-3-backpropagation-through-time-and-vanishing-gradients/}{exploding
gradients problem}. I also implement
\href{https://arxiv.org/pdf/1211.5063.pdf}{gradient clipping} in the
optimizer to avoid this issue.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}0}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}0.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}0.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
106/106 [==============================] - 252s - loss: 837.6048 - val\_loss: 728.9571
Epoch 2/20
106/106 [==============================] - 248s - loss: 751.8918 - val\_loss: 724.5152
Epoch 3/20
106/106 [==============================] - 240s - loss: 751.3006 - val\_loss: 731.0220
Epoch 4/20
106/106 [==============================] - 241s - loss: 751.3826 - val\_loss: 722.2856
Epoch 5/20
106/106 [==============================] - 240s - loss: 750.3567 - val\_loss: 722.4322
Epoch 6/20
106/106 [==============================] - 243s - loss: 750.7695 - val\_loss: 728.0798
Epoch 7/20
106/106 [==============================] - 239s - loss: 751.2005 - val\_loss: 718.4225
Epoch 8/20
106/106 [==============================] - 238s - loss: 751.4473 - val\_loss: 722.5540
Epoch 9/20
106/106 [==============================] - 240s - loss: 750.4353 - val\_loss: 731.8051
Epoch 10/20
106/106 [==============================] - 239s - loss: 750.7495 - val\_loss: 724.4694
Epoch 11/20
106/106 [==============================] - 241s - loss: 750.5170 - val\_loss: 725.6004
Epoch 12/20
106/106 [==============================] - 240s - loss: 751.3477 - val\_loss: 725.0794
Epoch 13/20
106/106 [==============================] - 241s - loss: 751.6187 - val\_loss: 722.3306
Epoch 14/20
106/106 [==============================] - 240s - loss: 751.4073 - val\_loss: 722.8860
Epoch 15/20
106/106 [==============================] - 240s - loss: 750.5793 - val\_loss: 737.3120
Epoch 16/20
106/106 [==============================] - 241s - loss: 750.4750 - val\_loss: 717.7959
Epoch 17/20
106/106 [==============================] - 240s - loss: 751.1697 - val\_loss: 726.1091
Epoch 18/20
106/106 [==============================] - 242s - loss: 750.5206 - val\_loss: 731.1050
Epoch 19/20
106/106 [==============================] - 240s - loss: 750.7316 - val\_loss: 717.7517
Epoch 20/20
106/106 [==============================] - 239s - loss: 750.4345 - val\_loss: 729.4995

    \end{Verbatim}

     \#\#\# (IMPLEMENTATION) Model 1: RNN + TimeDistributed Dense

After reading about the
\href{https://keras.io/layers/wrappers/}{TimeDistributed} wrapper and
the \href{https://keras.io/layers/normalization/}{BatchNormalization}
layer in the Keras documentation, I add
\href{https://arxiv.org/pdf/1510.01378.pdf}{batch normalization} to the
recurrent layer to reduce training times. The \texttt{TimeDistributed}
layer is used to find more complex patterns in the dataset. The unrolled
snapshot of the architecture is depicted below.

The next figure shows an equivalent, rolled depiction of the RNN that
shows the (\texttt{TimeDistrbuted}) dense and output layers in greater
detail.

The RNN function specifies an architecture that satisfies the following
requirements: - The first layer of the neural network should be an RNN
(\texttt{SimpleRNN}, \texttt{LSTM}, or \texttt{GRU}) that takes the time
sequence of audio features as input. I used \texttt{GRU} units here, but
also change \texttt{GRU} to \texttt{SimpleRNN} or \texttt{LSTM} to
experiment. - Whereas the architecture in \texttt{simple\_rnn\_model}
treated the RNN output as the final layer of the model, I use the output
of my RNN as a hidden layer. I use \texttt{TimeDistributed} to apply a
\texttt{Dense} layer to each of the time steps in the RNN output and
ensure that each \texttt{Dense} layer has \texttt{output\_dim} units.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{model\PYZus{}1} \PY{o}{=} \PY{n}{rnn\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,} \PY{c+c1}{\PYZsh{} change to 13 for MFCC features}
                            \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,}
                            \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
rnn (GRU)                    (None, None, 200)         217200    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_rnn (BatchNormalization)  (None, None, 200)         800       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_2 (TimeDist (None, None, 29)          5829      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 223,829
Trainable params: 223,429
Non-trainable params: 400
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    The code cell below is to train the neural network that I specified in
\texttt{input\_to\_softmax}. After the model has finished training, the
model is
\href{https://keras.io/getting-started/faq/\#how-can-i-save-a-keras-model}{saved}
in the HDF5 file \texttt{model\_1.h5}. The loss history is
\href{https://wiki.python.org/moin/UsingPickle}{saved} in
\texttt{model\_1.pickle}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}1}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}1.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}1.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to False for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
106/106 [==============================] - 255s - loss: 288.1190 - val\_loss: 236.9888
Epoch 2/20
106/106 [==============================] - 256s - loss: 197.4339 - val\_loss: 180.5550
Epoch 3/20
106/106 [==============================] - 255s - loss: 172.4593 - val\_loss: 166.2246
Epoch 4/20
106/106 [==============================] - 254s - loss: 159.3382 - val\_loss: 160.7301
Epoch 5/20
106/106 [==============================] - 252s - loss: 151.2782 - val\_loss: 153.2016
Epoch 6/20
106/106 [==============================] - 252s - loss: 145.2252 - val\_loss: 145.5385
Epoch 7/20
106/106 [==============================] - 252s - loss: 140.8640 - val\_loss: 154.2229
Epoch 8/20
106/106 [==============================] - 251s - loss: 136.8897 - val\_loss: 149.5983
Epoch 9/20
106/106 [==============================] - 253s - loss: 133.6898 - val\_loss: 139.5123
Epoch 10/20
106/106 [==============================] - 251s - loss: 129.7518 - val\_loss: 138.0164
Epoch 11/20
106/106 [==============================] - 252s - loss: 127.2061 - val\_loss: 138.2449
Epoch 12/20
106/106 [==============================] - 252s - loss: 125.6640 - val\_loss: 135.7322
Epoch 13/20
106/106 [==============================] - 252s - loss: 123.3391 - val\_loss: 133.0336
Epoch 14/20
106/106 [==============================] - 255s - loss: 121.4851 - val\_loss: 138.2461
Epoch 15/20
106/106 [==============================] - 251s - loss: 120.0853 - val\_loss: 132.3775
Epoch 16/20
106/106 [==============================] - 253s - loss: 118.4017 - val\_loss: 131.1959
Epoch 17/20
106/106 [==============================] - 257s - loss: 116.8537 - val\_loss: 129.7117
Epoch 18/20
106/106 [==============================] - 255s - loss: 115.2470 - val\_loss: 132.8626
Epoch 19/20
106/106 [==============================] - 255s - loss: 114.7861 - val\_loss: 132.7665
Epoch 20/20
106/106 [==============================] - 253s - loss: 112.4438 - val\_loss: 130.4221

    \end{Verbatim}

     \#\#\# (IMPLEMENTATION) Model 2: CNN + RNN + TimeDistributed Dense

The architecture in \texttt{cnn\_rnn\_model} adds an additional level of
complexity, by introducing a
\href{https://keras.io/layers/convolutional/\#conv1d}{1D convolution
layer}.

This layer incorporates many arguments that can be (optionally) tuned
when calling the \texttt{cnn\_rnn\_model} module.

When tuning the parameters, I avoid to choose settings that make the
convolutional layer overly small and make sure the temporal length of
the CNN layer is not shorter than the length of the transcribed text
label.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{n}{model\PYZus{}2} \PY{o}{=} \PY{n}{cnn\PYZus{}rnn\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,} \PY{c+c1}{\PYZsh{} change to 13 for MFCC features}
                                \PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,}
                                \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{11}\PY{p}{,} 
                                \PY{n}{conv\PYZus{}stride}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
                                \PY{n}{conv\PYZus{}border\PYZus{}mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{valid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv1d (Conv1D)              (None, None, 200)         354400    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_conv\_1d (BatchNormalizati (None, None, 200)         800       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
rnn (SimpleRNN)              (None, None, 200)         80200     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_rnn\_1d (BatchNormalizatio (None, None, 200)         800       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_1 (TimeDist (None, None, 29)          5829      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 442,029
Trainable params: 441,229
Non-trainable params: 800
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    The code cell below is to train the neural network you specified in
\texttt{input\_to\_softmax}. After the model has finished training, the
model is
\href{https://keras.io/getting-started/faq/\#how-can-i-save-a-keras-model}{saved}
in the HDF5 file \texttt{model\_2.h5}. The loss history is
\href{https://wiki.python.org/moin/UsingPickle}{saved} in
\texttt{model\_2.pickle}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}2}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}2.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}2.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to False for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
106/106 [==============================] - 80s - loss: 242.1462 - val\_loss: 214.8872
Epoch 2/20
106/106 [==============================] - 67s - loss: 180.2169 - val\_loss: 172.5518
Epoch 3/20
106/106 [==============================] - 66s - loss: 153.1871 - val\_loss: 152.5108
Epoch 4/20
106/106 [==============================] - 66s - loss: 140.6750 - val\_loss: 142.9356
Epoch 5/20
106/106 [==============================] - 66s - loss: 132.8889 - val\_loss: 141.4671
Epoch 6/20
106/106 [==============================] - 66s - loss: 126.0019 - val\_loss: 137.2023
Epoch 7/20
106/106 [==============================] - 65s - loss: 121.0836 - val\_loss: 135.1740
Epoch 8/20
106/106 [==============================] - 65s - loss: 117.0046 - val\_loss: 133.1203
Epoch 9/20
106/106 [==============================] - 65s - loss: 112.7053 - val\_loss: 133.6384
Epoch 10/20
106/106 [==============================] - 66s - loss: 109.0421 - val\_loss: 133.4340
Epoch 11/20
106/106 [==============================] - 65s - loss: 105.6881 - val\_loss: 131.7588
Epoch 12/20
106/106 [==============================] - 65s - loss: 102.7784 - val\_loss: 130.6749
Epoch 13/20
106/106 [==============================] - 65s - loss: 99.3475 - val\_loss: 133.0664
Epoch 14/20
106/106 [==============================] - 65s - loss: 97.1476 - val\_loss: 133.2393
Epoch 15/20
106/106 [==============================] - 65s - loss: 94.6840 - val\_loss: 133.7173
Epoch 16/20
106/106 [==============================] - 65s - loss: 91.5748 - val\_loss: 134.4975
Epoch 17/20
106/106 [==============================] - 66s - loss: 89.2073 - val\_loss: 135.9271
Epoch 18/20
106/106 [==============================] - 65s - loss: 86.7528 - val\_loss: 136.2900
Epoch 19/20
106/106 [==============================] - 65s - loss: 84.7389 - val\_loss: 139.0615
Epoch 20/20
106/106 [==============================] - 65s - loss: 82.5561 - val\_loss: 140.4820

    \end{Verbatim}

     \#\#\# (IMPLEMENTATION) Model 3: Deeper RNN + TimeDistributed Dense

The code in \texttt{rnn\_model}makes use of a single recurrent layer. I
specify an architecture in \texttt{deep\_rnn\_model} that utilizes a
variable number \texttt{recur\_layers} of recurrent layers. The figure
below shows the architecture that should be returned if
\texttt{recur\_layers=2}. In the figure, the output sequence of the
first recurrent layer is used as input for the next recurrent layer.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{n}{model\PYZus{}3} \PY{o}{=} \PY{n}{deep\PYZus{}rnn\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,} \PY{c+c1}{\PYZsh{} change to 13 for MFCC features}
                                 \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,}
                                 \PY{n}{recur\PYZus{}layers}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)} 
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
rnn\_0 (GRU)                  (None, None, 200)         217200    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_conv\_0 (BatchNormalizatio (None, None, 200)         800       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
rnn\_1 (GRU)                  (None, None, 200)         240600    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_conv\_1 (BatchNormalizatio (None, None, 200)         800       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_1 (TimeDist (None, None, 29)          5829      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 465,229
Trainable params: 464,429
Non-trainable params: 800
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    The code cell below to train the neural network you specified in
\texttt{input\_to\_softmax}. After the model has finished training, the
model is
\href{https://keras.io/getting-started/faq/\#how-can-i-save-a-keras-model}{saved}
in the HDF5 file \texttt{model\_3.h5}. The loss history is
\href{https://wiki.python.org/moin/UsingPickle}{saved} in
\texttt{model\_3.pickle}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}3}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}3.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}3.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to False for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
106/106 [==============================] - 528s - loss: 257.8840 - val\_loss: 221.6263
Epoch 2/20
106/106 [==============================] - 518s - loss: 219.4686 - val\_loss: 215.0356
Epoch 3/20
106/106 [==============================] - 516s - loss: 207.9945 - val\_loss: 211.2943
Epoch 4/20
106/106 [==============================] - 517s - loss: 177.5712 - val\_loss: 186.0663
Epoch 5/20
106/106 [==============================] - 517s - loss: 151.0159 - val\_loss: 169.3367
Epoch 6/20
106/106 [==============================] - 518s - loss: 140.2590 - val\_loss: 169.6269
Epoch 7/20
106/106 [==============================] - 516s - loss: 131.6139 - val\_loss: 160.7676
Epoch 8/20
106/106 [==============================] - 516s - loss: 120.9120 - val\_loss: 163.2195
Epoch 10/20
106/106 [==============================] - 521s - loss: 117.5832 - val\_loss: 160.1324
Epoch 11/20
106/106 [==============================] - 519s - loss: 114.2660 - val\_loss: 158.7377
Epoch 12/20
106/106 [==============================] - 515s - loss: 111.1606 - val\_loss: 157.7377
Epoch 13/20
106/106 [==============================] - 517s - loss: 109.1367 - val\_loss: 157.7869
Epoch 14/20
106/106 [==============================] - 518s - loss: 106.7260 - val\_loss: 157.3738
Epoch 15/20
106/106 [==============================] - 517s - loss: 103.6044 - val\_loss: 159.4514
Epoch 16/20
106/106 [==============================] - 517s - loss: 102.0748 - val\_loss: 162.6638
Epoch 17/20
106/106 [==============================] - 514s - loss: 100.4164 - val\_loss: 158.2996
Epoch 18/20
106/106 [==============================] - 511s - loss: 99.4343 - val\_loss: 164.2844
Epoch 19/20
106/106 [==============================] - 520s - loss: 97.9211 - val\_loss: 168.1244
Epoch 20/20
106/106 [==============================] - 513s - loss: 99.1015 - val\_loss: 162.4930

    \end{Verbatim}

     \#\#\# (IMPLEMENTATION) Model 4: Bidirectional RNN + TimeDistributed
Dense

After reading about the
\href{https://keras.io/layers/wrappers/}{Bidirectional} wrapper in the
Keras documentation, I specify an architecture that uses a single
bidirectional RNN layer, before a (\texttt{TimeDistributed}) dense
layer. The added value of a bidirectional RNN is described well in
\href{http://www.cs.toronto.edu/~hinton/absps/DRNN_speech.pdf}{this
paper}. \textgreater{} One shortcoming of conventional RNNs is that they
are only able to make use of previous context. In speech recognition,
where whole utterances are transcribed at once, there is no reason not
to exploit future context as well. Bidirectional RNNs (BRNNs) do this by
processing the data in both directions with two separate hidden layers
which are then fed forwards to the same output layer.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{n}{model\PYZus{}4} \PY{o}{=} \PY{n}{bidirectional\PYZus{}rnn\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,} \PY{c+c1}{\PYZsh{} change to 13 for MFCC features}
                                          \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_1 (Bidirection (None, None, 400)         434400    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_1 (TimeDist (None, None, 29)          11629     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 446,029
Trainable params: 446,029
Non-trainable params: 0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    The code cell below is to train the neural network you specified in
\texttt{input\_to\_softmax}. After the model has finished training, the
model is
\href{https://keras.io/getting-started/faq/\#how-can-i-save-a-keras-model}{saved}
in the HDF5 file \texttt{model\_4.h5}. The loss history is
\href{https://wiki.python.org/moin/UsingPickle}{saved} in
\texttt{model\_4.pickle}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}4}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}4.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}4.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to False for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
106/106 [==============================] - 483s - loss: 328.1847 - val\_loss: 261.3208
Epoch 2/20
106/106 [==============================] - 468s - loss: 239.6380 - val\_loss: 205.2616
Epoch 3/20
106/106 [==============================] - 469s - loss: 204.2879 - val\_loss: 191.6162
Epoch 4/20
106/106 [==============================] - 470s - loss: 192.3391 - val\_loss: 182.8804
Epoch 5/20
106/106 [==============================] - 467s - loss: 182.1424 - val\_loss: 174.7791
Epoch 6/20
106/106 [==============================] - 470s - loss: 173.0029 - val\_loss: 168.3547
Epoch 7/20
106/106 [==============================] - 470s - loss: 165.2273 - val\_loss: 161.5345
Epoch 8/20
106/106 [==============================] - 470s - loss: 157.2639 - val\_loss: 159.6401
Epoch 9/20
106/106 [==============================] - 465s - loss: 150.9472 - val\_loss: 153.2879
Epoch 10/20
106/106 [==============================] - 470s - loss: 145.1174 - val\_loss: 152.5278
Epoch 11/20
106/106 [==============================] - 469s - loss: 139.5687 - val\_loss: 146.8699
Epoch 12/20
106/106 [==============================] - 468s - loss: 134.3157 - val\_loss: 143.7871
Epoch 13/20
106/106 [==============================] - 466s - loss: 125.4830 - val\_loss: 138.9272
Epoch 15/20
106/106 [==============================] - 469s - loss: 121.4031 - val\_loss: 142.0759
Epoch 16/20
106/106 [==============================] - 466s - loss: 117.6418 - val\_loss: 136.8988
Epoch 17/20
106/106 [==============================] - 469s - loss: 114.1516 - val\_loss: 140.1772
Epoch 18/20
106/106 [==============================] - 468s - loss: 110.7538 - val\_loss: 139.2015
Epoch 19/20
106/106 [==============================] - 467s - loss: 107.5971 - val\_loss: 139.1418
Epoch 20/20
106/106 [==============================] - 466s - loss: 104.7536 - val\_loss: 138.9442

    \end{Verbatim}

     \#\#\# Compare the Models

The code cell below is to evaluate the performance of the drafted deep
learning models. The training and validation loss are plotted for each
model.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{k+kn}{from} \PY{n+nn}{glob} \PY{k}{import} \PY{n}{glob}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{\PYZus{}pickle} \PY{k}{as} \PY{n+nn}{pickle}
        \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{n}{sns}\PY{o}{.}\PY{n}{set\PYZus{}style}\PY{p}{(}\PY{n}{style}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{white}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} obtain the paths for the saved model history}
        \PY{n}{all\PYZus{}pickles} \PY{o}{=} \PY{n+nb}{sorted}\PY{p}{(}\PY{n}{glob}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{results/*.pickle}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} extract the name of each model}
        \PY{n}{model\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{n}{item}\PY{p}{[}\PY{l+m+mi}{8}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{7}\PY{p}{]} \PY{k}{for} \PY{n}{item} \PY{o+ow}{in} \PY{n}{all\PYZus{}pickles}\PY{p}{]}
        \PY{c+c1}{\PYZsh{} extract the loss history for each model}
        \PY{n}{valid\PYZus{}loss} \PY{o}{=} \PY{p}{[}\PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(} \PY{n+nb}{open}\PY{p}{(} \PY{n}{i}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rb}\PY{l+s+s2}{\PYZdq{}} \PY{p}{)} \PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}loss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{all\PYZus{}pickles}\PY{p}{]}
        \PY{n}{train\PYZus{}loss} \PY{o}{=} \PY{p}{[}\PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(} \PY{n+nb}{open}\PY{p}{(} \PY{n}{i}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rb}\PY{l+s+s2}{\PYZdq{}} \PY{p}{)} \PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{loss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{all\PYZus{}pickles}\PY{p}{]}
        \PY{c+c1}{\PYZsh{} save the number of epochs used to train each model}
        \PY{n}{num\PYZus{}epochs} \PY{o}{=} \PY{p}{[}\PY{n+nb}{len}\PY{p}{(}\PY{n}{valid\PYZus{}loss}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{valid\PYZus{}loss}\PY{p}{)}\PY{p}{)}\PY{p}{]}
        
        \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} plot the training loss vs. epoch for each model}
        \PY{n}{ax1} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{121}\PY{p}{)}
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{all\PYZus{}pickles}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{num\PYZus{}epochs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{num\PYZus{}epochs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{,} 
                    \PY{n}{train\PYZus{}loss}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{n}{model\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} clean up the plot}
        \PY{n}{ax1}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}  
        \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{num\PYZus{}epochs}\PY{p}{)}\PY{p}{]}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Epoch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training Loss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} plot the validation loss vs. epoch for each model}
        \PY{n}{ax2} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{122}\PY{p}{)}
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{all\PYZus{}pickles}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{num\PYZus{}epochs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{num\PYZus{}epochs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{,} 
                    \PY{n}{valid\PYZus{}loss}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{n}{model\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} clean up the plot}
        \PY{n}{ax2}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}  
        \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{num\PYZus{}epochs}\PY{p}{)}\PY{p}{]}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Epoch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Loss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_31_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subparagraph{Observations:}\label{observations}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \begin{itemize}
  \tightlist
  \item
    Model\_0 has both very high Training Loss and Validation Loss. It is
    too naive to capture the pattern in the data.
  \end{itemize}
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Model\_1 is a simple RNN combined with a Timedistributed layer. It
  gives us the lowest validation error. It is the best in terms of
  validation error. However, it suffers from overfitting as Epoch
  increases.
\item
  Model\_2 is a cnn combined with rnn. From the plot, we can tell that
  CNN is limited in dealing with suquencial task.
\item
  Model\_3 is a deeper RNN. It has a strong representative power, so it
  gives us the lowest training loss. However, it suffers from
  overfitting.
\item
  Model\_4 is bidirectional RNN. It does not perform well enough and
  this may be due to the property of the dataset.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  The dataset I use here is relatively small, so the simple RNN actually
  can gives the best validation error. While at the same time, since I
  got slightly different result everytime I ran the model, this might
  indicate that the result is not state enough and statistically
  significant.
\end{enumerate}

     \#\#\# (IMPLEMENTATION) Final Model

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  In order to increase the representative power of the model, I choose
  the deeper RNN layer(2) with BatchNormalization in each RNN layer.
\item
  I also use a bidirection layer to get more imformation of the dataset.
  Though it did not help in a single layer RNN scenario, it helps here.
\item
  I add a timedistributed wrapper in the end for the purpose of dealing
  time dimension.
\item
  I add dropout to
  \href{https://faroit.github.io/keras-docs/1.0.2/layers/recurrent/}{recurrent
  layers} because the model is overfitting to the training dataset and
  pay special attention to the \texttt{dropout\_W} and
  \texttt{dropout\_U} arguments. This
  \href{http://arxiv.org/abs/1512.05287}{paper} also provides some
  interesting theoretical background.
\item
  I add a \textbf{dilated convolutions} layer in the model
  (https://arxiv.org/abs/1609.03499).
\item
  I also add \textbf{max pooling} to the model to makes use of
  convolutional layers according to
  \href{https://arxiv.org/pdf/1701.02720.pdf}{this paper}
\end{enumerate}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{} specify the model}
        \PY{n}{model\PYZus{}end} \PY{o}{=} \PY{n}{final\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{recur\PYZus{}layers}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_1 (Bidirection (None, None, 400)         434400    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_0 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_2 (Bidirection (None, None, 400)         721200    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_1 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_1 (TimeDist (None, None, 29)          11629     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 1,170,429
Trainable params: 1,168,829
Non-trainable params: 1,600
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None

    \end{Verbatim}

    I execute the code cell below to train the neural network specified in
\texttt{input\_to\_softmax}. After the model has finished training, the
model is
\href{https://keras.io/getting-started/faq/\#how-can-i-save-a-keras-model}{saved}
in the HDF5 file \texttt{model\_end.h5}. The loss history is
\href{https://wiki.python.org/moin/UsingPickle}{saved} in
\texttt{model\_end.pickle}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{n}{train\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{model\PYZus{}end}\PY{p}{,} 
                    \PY{n}{pickle\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}end.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{save\PYZus{}model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}end.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                    \PY{n}{spectrogram}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)} \PY{c+c1}{\PYZsh{} change to False for MFCC features}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
101/101 [==============================] - 1059s - loss: 317.2904 - val\_loss: 243.9566
Epoch 2/20
101/101 [==============================] - 1058s - loss: 248.5638 - val\_loss: 226.2877
Epoch 3/20
101/101 [==============================] - 1046s - loss: 235.2213 - val\_loss: 226.9678
Epoch 4/20
101/101 [==============================] - 1054s - loss: 227.5336 - val\_loss: 214.1289
Epoch 5/20
101/101 [==============================] - 1067s - loss: 216.5156 - val\_loss: 204.1930
Epoch 6/20
101/101 [==============================] - 1580s - loss: 188.0109 - val\_loss: 176.7203
Epoch 7/20
101/101 [==============================] - 1042s - loss: 166.0132 - val\_loss: 157.6658
Epoch 8/20
101/101 [==============================] - 1019s - loss: 151.7567 - val\_loss: 151.2566
Epoch 9/20
101/101 [==============================] - 1014s - loss: 142.2072 - val\_loss: 143.3087
Epoch 10/20
101/101 [==============================] - 947s - loss: 134.0488 - val\_loss: 140.7913
Epoch 11/20
101/101 [==============================] - 910s - loss: 127.3500 - val\_loss: 136.8459
Epoch 12/20
101/101 [==============================] - 954s - loss: 121.8108 - val\_loss: 137.1908
Epoch 13/20
101/101 [==============================] - 949s - loss: 116.5913 - val\_loss: 133.8050
Epoch 14/20
101/101 [==============================] - 932s - loss: 111.6759 - val\_loss: 133.0900
Epoch 15/20
101/101 [==============================] - 936s - loss: 107.0792 - val\_loss: 133.7958
Epoch 16/20
101/101 [==============================] - 936s - loss: 102.8524 - val\_loss: 133.0760
Epoch 17/20
101/101 [==============================] - 940s - loss: 98.6578 - val\_loss: 131.6617
Epoch 18/20
101/101 [==============================] - 940s - loss: 94.6309 - val\_loss: 135.5383
Epoch 19/20
101/101 [==============================] - 942s - loss: 90.6332 - val\_loss: 133.3882
Epoch 20/20
101/101 [==============================] - 952s - loss: 86.9044 - val\_loss: 132.7322

    \end{Verbatim}

     \#\# STEP 3: Obtain Predictions

The function below is to decode the predictions of the acoustic model.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{from} \PY{n+nn}{data\PYZus{}generator} \PY{k}{import} \PY{n}{AudioGenerator}
        \PY{k+kn}{from} \PY{n+nn}{keras} \PY{k}{import} \PY{n}{backend} \PY{k}{as} \PY{n}{K}
        \PY{k+kn}{from} \PY{n+nn}{utils} \PY{k}{import} \PY{n}{int\PYZus{}sequence\PYZus{}to\PYZus{}text}
        \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{Audio}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}predictions}\PY{p}{(}\PY{n}{index}\PY{p}{,} \PY{n}{partition}\PY{p}{,} \PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{p}{,} \PY{n}{model\PYZus{}path}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} Print a model\PYZsq{}s decoded predictions}
        \PY{l+s+sd}{    Params:}
        \PY{l+s+sd}{        index (int): The example you would like to visualize}
        \PY{l+s+sd}{        partition (str): One of \PYZsq{}train\PYZsq{} or \PYZsq{}validation\PYZsq{}}
        \PY{l+s+sd}{        input\PYZus{}to\PYZus{}softmax (Model): The acoustic model}
        \PY{l+s+sd}{        model\PYZus{}path (str): Path to saved acoustic model\PYZsq{}s weights}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{c+c1}{\PYZsh{} load the train and test data}
            \PY{n}{data\PYZus{}gen} \PY{o}{=} \PY{n}{AudioGenerator}\PY{p}{(}\PY{p}{)}
            \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{load\PYZus{}train\PYZus{}data}\PY{p}{(}\PY{p}{)}
            \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{load\PYZus{}validation\PYZus{}data}\PY{p}{(}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} obtain the true transcription and the audio features }
            \PY{k}{if} \PY{n}{partition} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{validation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{transcr} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{valid\PYZus{}texts}\PY{p}{[}\PY{n}{index}\PY{p}{]}
                \PY{n}{audio\PYZus{}path} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{valid\PYZus{}audio\PYZus{}paths}\PY{p}{[}\PY{n}{index}\PY{p}{]}
                \PY{n}{data\PYZus{}point} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{normalize}\PY{p}{(}\PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{featurize}\PY{p}{(}\PY{n}{audio\PYZus{}path}\PY{p}{)}\PY{p}{)}
            \PY{k}{elif} \PY{n}{partition} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                \PY{n}{transcr} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{train\PYZus{}texts}\PY{p}{[}\PY{n}{index}\PY{p}{]}
                \PY{n}{audio\PYZus{}path} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{train\PYZus{}audio\PYZus{}paths}\PY{p}{[}\PY{n}{index}\PY{p}{]}
                \PY{n}{data\PYZus{}point} \PY{o}{=} \PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{normalize}\PY{p}{(}\PY{n}{data\PYZus{}gen}\PY{o}{.}\PY{n}{featurize}\PY{p}{(}\PY{n}{audio\PYZus{}path}\PY{p}{)}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{k}{raise} \PY{n+ne}{Exception}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Invalid partition!  Must be }\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{ or }\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{validation}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                
            \PY{c+c1}{\PYZsh{} obtain and decode the acoustic model\PYZsq{}s predictions}
            \PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{model\PYZus{}path}\PY{p}{)}
            \PY{n}{prediction} \PY{o}{=} \PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{data\PYZus{}point}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
            \PY{n}{output\PYZus{}length} \PY{o}{=} \PY{p}{[}\PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{.}\PY{n}{output\PYZus{}length}\PY{p}{(}\PY{n}{data\PYZus{}point}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{]} 
            \PY{n}{pred\PYZus{}ints} \PY{o}{=} \PY{p}{(}\PY{n}{K}\PY{o}{.}\PY{n}{eval}\PY{p}{(}\PY{n}{K}\PY{o}{.}\PY{n}{ctc\PYZus{}decode}\PY{p}{(}
                        \PY{n}{prediction}\PY{p}{,} \PY{n}{output\PYZus{}length}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{.}\PY{n}{flatten}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} play the audio file, and display the true and predicted transcriptions}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{*}\PY{l+m+mi}{80}\PY{p}{)}
            \PY{n}{Audio}\PY{p}{(}\PY{n}{audio\PYZus{}path}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True transcription:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{transcr}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{*}\PY{l+m+mi}{80}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Predicted transcription:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{int\PYZus{}sequence\PYZus{}to\PYZus{}text}\PY{p}{(}\PY{n}{pred\PYZus{}ints}\PY{p}{)}\PY{p}{)}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{*}\PY{l+m+mi}{80}\PY{p}{)}
\end{Verbatim}


    The code cell below is to obtain the transcription predicted by the
final model for the first example in the training dataset.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{get\PYZus{}predictions}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} 
                        \PY{n}{partition}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{final\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{recur\PYZus{}layers}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} 
                        \PY{n}{model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{results/model\PYZus{}end.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_3 (Bidirection (None, None, 400)         434400    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_0 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_4 (Bidirection (None, None, 400)         721200    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_1 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_2 (TimeDist (None, None, 29)          11629     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 1,170,429
Trainable params: 1,168,829
Non-trainable params: 1,600
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None
--------------------------------------------------------------------------------
True transcription:

mister quilter is the apostle of the middle classes and we are glad to welcome his gospel
--------------------------------------------------------------------------------
Predicted transcription:

mis ter queltar asappostlil to widal casisann war glad  wel omm his gospl
--------------------------------------------------------------------------------

    \end{Verbatim}

    The next code cell is to visualize the model's prediction for the first
example in the validation dataset.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{n}{get\PYZus{}predictions}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} 
                         \PY{n}{partition}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{validation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                         \PY{n}{input\PYZus{}to\PYZus{}softmax}\PY{o}{=}\PY{n}{final\PYZus{}model}\PY{p}{(}\PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{161}\PY{p}{,}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{recur\PYZus{}layers}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} 
                         \PY{n}{model\PYZus{}path}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{results/model\PYZus{}end.h5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
the\_input (InputLayer)       (None, None, 161)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_5 (Bidirection (None, None, 400)         434400    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_0 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bidirectional\_6 (Bidirection (None, None, 400)         721200    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
bn\_1 (BatchNormalization)    (None, None, 400)         1600      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
time\_distributed\_3 (TimeDist (None, None, 29)          11629     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
softmax (Activation)         (None, None, 29)          0         
=================================================================
Total params: 1,170,429
Trainable params: 1,168,829
Non-trainable params: 1,600
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
None
--------------------------------------------------------------------------------
True transcription:

stuff it into you his belly counselled him
--------------------------------------------------------------------------------
Predicted transcription:

stoffodin tu his batly capcotim
--------------------------------------------------------------------------------

    \end{Verbatim}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
